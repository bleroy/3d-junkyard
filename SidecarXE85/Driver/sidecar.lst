mads (generated by atasm)

Source: ./SidecarXE85/Driver/sidecar.asm
150 0600  A5 0C    	LDA	DOSINI		; Copy DOS init to WRMEXT
151 0602  8D 2C 06     STA	WRMEXT + 1
152 0605  A5 0D        LDA	DOSINI + 1
153 0607  8D 2D 06     STA	WRMEXT + 2
155 060A  A9 28    	LDA	#<WARMST	; Replace DOSINI with WARMST
156 060C  85 0C        STA	DOSINI
157 060E  A9 06        LDA	#>WARMST
158 0610  85 0D        STA	DOSINI + 1
161 0612  AD 24 02 	LDA	VVBLKD		; Save VVBLKD for keypad exit point
162 0615  8D BA 06     STA	EXIT + 1
163 0618  AD 25 02     LDA	VVBLKD + 1
164 061B  8D BB 06     STA	EXIT + 2
166 061E  A0 57        LDY	#<KPAD		; Replace VVBLKD with keypad entry point
167 0620  A2 06        LDX	#>KPAD
168 0622  A9 07        LDA	#7		    ; Deferred VBI
169 0624  20 5C E4     JSR	SETVBV
170 0627  60           RTS
172 0628  20 12 06 WARMST:	JSR	KPADVBI	; Entered when user hits system reset
173 062B  4C 00 00 WRMEXT:	JMP	0		; Chain to DOSINI
177 062E  0C 1C  	.byte	PAD_ESC,	KEY_ESC
178 0630  14 72      .byte	PAD_NO,		KEY_CLOSINGPARAN
179 0632  10 34      .byte	PAD_DEL,	KEY_DELETE
180 0634  18 70      .byte	PAD_YES,	KEY_OPENINGPARAN
181 0636  1C 32      .byte	PAD_0,		KEY_0
182 0638  19 1F      .byte	PAD_1,		KEY_1
183 063A  1A 1E      .byte	PAD_2,		KEY_2
184 063C  1B 1A      .byte	PAD_3,		KEY_3
185 063E  11 18      .byte	PAD_4,		KEY_4
186 0640  12 1D      .byte	PAD_5,		KEY_5
187 0642  13 1B      .byte	PAD_6,		KEY_6
188 0644  15 33      .byte	PAD_7,		KEY_7
189 0646  16 35      .byte	PAD_8,		KEY_8
190 0648  17 30      .byte	PAD_9,		KEY_9
191 064A  1D 22      .byte	PAD_PERIOD,	KEY_PERIOD
192 064C  1F 0E      .byte	PAD_MINUS,	KEY_DASH
193 064E  1E 0C      .byte	PAD_ENTER,	KEY_RETURN
194 0650  00 26      .byte	PAD_SLASH,	KEY_SLASH
195 0652  00 06      .byte	PAD_PLUS,	KEY_PLUS
196 0654  00 07      .byte	PAD_ASTERISK,	KEY_ASTERISK
198 0656  00      .byte 0			; End of table
201 0657  AD 85 02 	LDA	STRIG1		; Key pressed?
202 065A  D0 3E        BNE	KPADDM		; Exit if no key pressed
203 065C  A9 00        LDA	#0		    ; Reset attract mode
204 065E  85 4D        STA	ATTRACT
206 0660  AD 00 D3     LDA	PORTA		; Read cable pin of port 2
207 0663  4A           LSR
208 0664  4A           LSR
209 0665  4A           LSR
210 0666  4A           LSR
211 0667  8D BC 06     STA	TEMP
212 066A  AD 08 D2     LDA	ALLPOT		; Read ALLPOT for 5th cable pin stat
213 066D  29 08        AND	#BPOT		; Mask for 5th pin
214 066F  49 08        EOR	#BPOT		; Complement bit (0 is valid)
215 0671  0A           ASL
216 0672  0D BC 06     ORA	TEMP		; A has key value
217 0675  A0 00        LDY	#0		; Init counter
220 0677  D9 2E 06 	CMP	KPADTAB,Y	; Match keypad table entry?
221 067A  F0 07        BEQ	KPADMAT		; Jump if match
222 067C  C8           INY			; Inc to next entry
223 067D  C8           INY
224 067E  BE 2E 06     LDX	KPADTAB,Y	; End of table?
225 0681  D0 F4        BNE	KPADCK
228 0683  AA       	TAX	    		; Save key value
229 0684  C8           INY		    	; Get Pokey keycode
230 0685  B9 2E 06     LDA	KPADTAB,Y	; A has keycode
231 0688  CD BD 06     CMP	KPADCOD		; Same as prior keycode?
232 068B  F0 19        BEQ	KPADSAM		; Branch if same
233 068D  8D BD 06     STA	KPADCOD		; Else store new code
234 0690  8D FC 02     STA	CH
235 0693  A9 30        LDA	#TIMERA		; Reset timer
236 0695  8D BE 06     STA	KPADREP
237 0698  D0 05        BNE	EXIT1
240 069A  A9 C0    	LDA	#$C0		; Load dummy variable
241 069C  8D BD 06     STA	KPADCOD
244 069F  A9 01    	LDA	#1		    ; Reset BRK press flag
245 06A1  8D BF 06     STA	BRKPRS
246 06A4  D0 13        BNE	EXIT
249 06A6  AE BE 06 	LDX	KPADREP		; Auto-repeat expired?
250 06A9  CA           DEX		    	; Decrement timer
251 06AA  D0 0A        BNE	KPADXX		; Branch if not
252 06AC  8D FC 02     STA	CH  		; Store keycode
253 06AF  A9 06    	LDA	#TIMERB		; Reset timer
254 06B1  8D BE 06     STA	KPADREP
255 06B4  D0 E9        BNE	EXIT1
258 06B6  8E BE 06 	STX	KPADREP
261 06B9  4C 00 00 	JMP	0		    ; Chain to deferred VBLANK
264 06BC  00      .byte	0		; Temp variable
266 06BD  00  	.byte	0		; Prior keycode
268 06BE  30  	.byte	$30		; Auto-repeat timer
271 06BF  01      .byte	1		; Break press flag
